{% extends 'faithlink/basemenu.html' %}

{% block content %}
<div id="event-app" class="container py-4">

  <!-- Loading Spinner -->
  <div class="semipolar-spinner" v-show="isLoading">
    <div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div><div class="ring"></div>
    <p>Loading events...</p>
  </div>

  <h2 style="font-size: 2.5rem; font-weight: 700; color: #ce7659; margin-bottom: 25px;">Upcoming Events</h2>

  <!-- Events Card View -->
  <el-row :gutter="20">
    <el-col :xs="24" :sm="12" :md="8" v-for="event in events" :key="event.id">
      <el-card shadow="hover" class="event-card" style="margin-bottom: 20px;">
        <div>
          <h3 style="font-weight: 600; font-size: 1.3rem; color: #333;"><span v-text="event.name"></span></h3>
          <p><strong>Date:</strong> <span v-text="formatDate(event.date)"></span></p>

          <p><strong>location:</strong> <span v-text="event.location"></span></p>
        </div>
      </el-card>
    </el-col>
  </el-row>

</div>
{% endblock %}

{% block script %}
<script>
  new Vue({
    el: '#event-app',
    data() {
      return {
        isLoading: true,
        events: []
      };
    },
    methods: {
      formatDate(dateStr) {
        const options = { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
        return new Date(dateStr).toLocaleString(undefined, options);
      },
      fetchEvents() {
        this.isLoading = true;
        axios.get('/api/events/')
          .then(res => {
            const now = new Date();
            this.events = res.data.filter(event => new Date(event.date) > now);
            this.isLoading = false;
          })
          .catch(() => {
            this.isLoading = false;
          });
      }
    },
    created() {
      this.fetchEvents();
    }
  });
</script>
{% endblock %}

<style>
  .event-card {
    transition: all 0.3s ease-in-out;
  }
  .event-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.2);
  }

  .semipolar-spinner, .semipolar-spinner * {
    box-sizing: border-box;
  }

  .semipolar-spinner {
    position: fixed;
    z-index: 999;
    height: 5em;
    width: 5em;
    overflow: visible;
    margin: auto;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
  }

  .semipolar-spinner .ring {
    border-radius: 50%;
    position: absolute;
    border: calc(65px * 0.05) solid transparent;
    border-top-color: #4a90e2;
    border-left-color: #4a90e2;
    animation: semipolar-spinner-animation 2s infinite;
  }

  .semipolar-spinner .ring:nth-child(1) {
    height: calc(65px - 65px * 0.2 * 0);
    width: calc(65px - 65px * 0.2 * 0);
    top: calc(65px * 0.1 * 0);
    left: calc(65px * 0.1 * 0);
    animation-delay: calc(2000ms * 0.1 * 4);
    z-index: 5;
  }

  .semipolar-spinner .ring:nth-child(2) {
    height: calc(65px - 65px * 0.2 * 1);
    width: calc(65px - 65px * 0.2 * 1);
    top: calc(65px * 0.1 * 1);
    left: calc(65px * 0.1 * 1);
    animation-delay: calc(2000ms * 0.1 * 3);
    z-index: 4;
  }

  .semipolar-spinner .ring:nth-child(3) {
    height: calc(65px - 65px * 0.2 * 2);
    width: calc(65px - 65px * 0.2 * 2);
    top: calc(65px * 0.1 * 2);
    left: calc(65px * 0.1 * 2);
    animation-delay: calc(2000ms * 0.1 * 2);
    z-index: 3;
  }

  .semipolar-spinner .ring:nth-child(4) {
    height: calc(65px - 65px * 0.2 * 3);
    width: calc(65px - 65px * 0.2 * 3);
    top: calc(65px * 0.1 * 3);
    left: calc(65px * 0.1 * 3);
    animation-delay: calc(2000ms * 0.1 * 1);
    z-index: 2;
  }

  .semipolar-spinner .ring:nth-child(5) {
    height: calc(65px - 65px * 0.2 * 4);
    width: calc(65px - 65px * 0.2 * 4);
    top: calc(65px * 0.1 * 4);
    left: calc(65px * 0.1 * 4);
    animation-delay: calc(2000ms * 0.1 * 0);
    z-index: 1;
  }

  @keyframes semipolar-spinner-animation {
    50% {
      transform: rotate(360deg) scale(0.7);
    }
  }
</style>
